<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PH Flood & Weather Monitor</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font for better readability -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- OpenLayers CSS for map styling -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css">
    <!-- OpenLayers JS for interactive map functionality -->
    <script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js"></script>
    <!-- Tone.js for sound effects -->
    <script src="https://unpkg.com/tone@14.7.58/build/Tone.js"></script>
    <style>
        /* Base styles for dark mode theme */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: #0d141e;
            color: #f8fafc;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        header {
            background-color: #1a2531;
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 10;
        }
        main {
            display: flex;
            flex: 1;
            position: relative;
        }
        .sidebar {
            width: 100%; /* Default to full width on mobile */
            background-color: #1a2531;
            color: #f8fafc;
            padding: 1.5rem;
            overflow-y: auto;
            position: absolute; /* Position absolutely on mobile */
            z-index: 20;
            top: 0;
            left: 0;
            height: 100%;
            transform: translateX(-100%); /* Hidden by default */
            transition: transform 0.3s ease-in-out;
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.3);
        }
        .sidebar.active {
            transform: translateX(0); /* Active state is visible */
        }
        #map-container {
            flex: 1;
            position: relative;
            background-color: #e2e8f0;
            width: 100%; /* Full width on mobile */
            height: 100%;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        
        /* Desktop styles (>= 768px) */
        @media (min-width: 768px) {
            main {
                flex-direction: row;
            }
            .sidebar {
                width: 400px;
                position: relative;
                transform: translateX(0); /* Always visible on desktop */
                flex-shrink: 0;
                height: calc(100vh - 64px);
            }
            .sidebar.active {
                transform: translateX(0);
            }
        }
        .info-box {
            background-color: #2a3847;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .info-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }
        .info-box h3, .info-box h4 {
            font-weight: 600;
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: #f8fafc;
        }
        .input-group {
            margin-bottom: 1rem;
        }
        .input-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.25rem;
            color: #cbd5e1;
        }
        .input-group input[type="range"], .input-group input[type="number"], .input-group select {
            width: 100%;
            border-radius: 0.375rem;
            border: 1px solid #4a5568;
            padding: 0.5rem 0.75rem;
            background-color: #3e4a57;
            color: #f8fafc;
        }
        .input-group input[type="checkbox"] {
            margin-right: 0.5rem;
        }
        .button {
            display: inline-block;
            background-color: #0d9488; /* Teal-600 */
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .button:hover {
            background-color: #0f766e; /* Teal-700 */
            transform: translateY(-1px);
        }
        .btn-red {
            background-color: #ef4444; /* Red-500 */
        }
        .btn-red:hover {
            background-color: #dc2626; /* Red-600 */
        }
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .custom-modal {
            background-color: #2a3847;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            text-align: center;
            color: #f8fafc;
        }
        .warning-box {
            background-color: #2a3847;
            border-left: 4px solid #ef4444;
            padding: 0.75rem;
            border-radius: 0.25rem;
            margin-bottom: 0.75rem;
        }
        .warning-box.yellow { border-color: #eab308; }
        .warning-box.orange { border-color: #f97316; }
        .warning-box.red { border-color: #ef4444; }
        .forecast-box {
            background-color: #2a3847;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
        }
        .forecast-value {
            font-size: 3rem;
            font-weight: 700;
            color: #0d9488;
            margin-top: 0.5rem;
        }
        .forecast-label {
            font-size: 0.875rem;
            color: #cbd5e1;
        }
        .forecast-unit {
            font-size: 1.5rem;
            font-weight: 600;
        }
        #road-selection-container {
            margin-bottom: 1.5rem;
        }
        .tab-button-group {
            display: flex;
            width: 100%;
            margin-bottom: 1.5rem;
            background-color: #2a3847;
            border-radius: 0.75rem;
            padding: 0.5rem;
        }
        .tab-button {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease, color 0.2s ease;
            color: #cbd5e1;
        }
        .tab-button.active {
            background-color: #0d9488;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .map-control-btn {
            background-color: #1a2531;
            color: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.2s;
        }
        .map-control-btn:hover {
            background-color: #2a3847;
        }
        .map-controls-container {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 10;
        }
        .map-legend {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            background: rgba(42, 56, 71, 0.8);
            border-radius: 0.5rem;
            padding: 0.75rem;
            font-size: 0.875rem;
            z-index: 10;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 0.25rem;
            margin-right: 0.5rem;
            border: 1px solid #4a5568;
        }
        #precipitation-graph {
            background-color: #3e4a57;
            border-radius: 0.5rem;
            margin-top: 1rem;
            border: 1px solid #4a5568;
        }
        .notification-bar {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background-color: #10b981; /* Green-500 */
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            z-index: 50;
        }
    </style>
</head>
<body>
    <header class="shadow-lg">
        <!-- Mobile menu toggle button, hidden on desktop -->
        <button id="toggle-sidebar-btn" class="text-white text-xl md:hidden">
            <i class="fas fa-bars"></i>
        </button>
        <h1 class="text-2xl font-bold">PH Flood & Weather Monitor</h1>
        <div class="flex items-center space-x-4">
            <span id="current-time" class="text-white font-medium"></span>
        </div>
    </header>

    <main class="md:flex-row flex-col">
        <!-- Left Sidebar (Information & Controls) -->
        <aside class="sidebar" id="sidebar">
            <div class="tab-button-group">
                <button class="tab-button active" data-tab="main">Main</button>
                <button class="tab-button" data-tab="forecast">Forecast</button>
                <button class="tab-button" data-tab="settings">Settings</button>
            </div>

            <!-- Main Tab Content -->
            <div id="main" class="tab-content active">
                <div class="info-box flex flex-col items-center">
                    <h3 class="text-center">Current Status</h3>
                    <p class="text-white text-xl font-bold mt-2">Current Flood Height</p>
                    <p class="text-5xl font-extrabold text-[#0d9488]"><span id="current-flood-height">0.00</span><span class="text-2xl font-semibold">m</span></p>
                    <p class="text-lg font-semibold mt-4">Current Weather</p>
                    <p class="text-sm">Temp: <span id="current-temp">0.0</span>Â°C | Humidity: <span id="current-humidity">0</span>%</p>
                    <p class="text-sm mt-2">Total Precipitation: <span id="total-precipitation">0.00</span> mm</p>
                </div>

                <div class="info-box">
                    <h3 class="text-center">Warnings & Alerts</h3>
                    <div id="warnings-log" class="text-sm space-y-2">
                        <div class="p-2 rounded-md text-sm warning-box red">
                            <p class="warning-title">App Status</p>
                            <p class="warning-description">Please wait for roads to load...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Forecast Tab Content -->
            <div id="forecast" class="tab-content">
                <div class="info-box">
                    <h3 class="text-center">Rainfall Forecast</h3>
                    <div class="flex justify-between items-center mb-4">
                        <div class="text-center">
                            <p class="text-xl font-bold">Next 3 hrs</p>
                            <p class="text-3xl font-bold text-[#0d9488]" id="forecast-3hr-rainfall">0mm</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xl font-bold">Next 6 hrs</p>
                            <p class="text-3xl font-bold text-[#0d9488]" id="forecast-6hr-rainfall">0mm</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xl font-bold">Next 12 hrs</p>
                            <p class="text-3xl font-bold text-[#0d9488]" id="forecast-12hr-rainfall">0mm</p>
                        </div>
                    </div>
                </div>
                 <div class="info-box">
                    <h3 class="text-center">Flood Forecast</h3>
                    <div class="flex justify-between items-center mb-4">
                        <div class="text-center">
                            <p class="text-xl font-bold">Next 3 hrs</p>
                            <p class="text-3xl font-bold text-[#0d9488]" id="forecast-3hr-flood">0m</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xl font-bold">Next 6 hrs</p>
                            <p class="text-3xl font-bold text-[#0d9488]" id="forecast-6hr-flood">0m</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xl font-bold">Next 12 hrs</p>
                            <p class="text-3xl font-bold text-[#0d9488]" id="forecast-12hr-flood">0m</p>
                        </div>
                    </div>
                </div>
                <div class="info-box">
                    <h3 class="text-center">PAGASA Advisories</h3>
                    <div id="pagasa-advisories" class="space-y-4">
                        <p class="text-sm text-center text-gray-400">Advisories will appear here during a simulation.</p>
                    </div>
                </div>
            </div>

            <!-- Settings Tab Content -->
            <div id="settings" class="tab-content">
                <div class="info-box">
                    <h3 class="text-center">Simulation Controls</h3>
                    <div class="input-group">
                        <label for="simulation-duration">Simulation Duration:</label>
                        <div class="flex space-x-2">
                            <input type="number" id="simulation-duration" min="1" value="1" class="w-2/3">
                            <select id="duration-unit" class="w-1/3 rounded-md p-2">
                                <option value="minutes">Minutes</option>
                                <option value="hours">Hours</option>
                                <option value="days">Days</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="session-type">Session Type:</label>
                        <select id="session-type" class="w-full rounded-md p-2">
                            <option value="normal">Normal Simulation</option>
                            <option value="rain">Rain Event</option>
                            <option value="thunderstorm">Thunderstorm</option>
                            <option value="tropical-cyclone">Tropical Cyclone</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="precipitation-rate">Base Precipitation Rate: <span id="precipitation-value">0</span> mm/hr</label>
                        <input type="range" id="precipitation-rate" min="0" max="100" value="0">
                    </div>
                    <div class="flex items-center justify-between mb-4">
                        <label for="random-precipitation" class="text-white">Random Precipitation:</label>
                        <input type="checkbox" id="random-precipitation" class="form-checkbox h-5 w-5 text-teal-600 rounded-full" checked>
                    </div>
                    <canvas id="precipitation-graph" width="300" height="100"></canvas>
                    <div class="flex justify-center mt-4">
                        <button id="start-simulation-btn" class="button w-full">Start Simulation</button>
                    </div>
                    <div class="flex justify-center mt-2">
                        <button id="run-instant-btn" class="button w-full">Run Instant Simulation</button>
                    </div>
                    <div class="flex justify-center mt-2">
                        <button id="reset-simulation-btn" class="button btn-red w-full">Reset Simulation</button>
                    </div>
                </div>

                <div class="info-box">
                    <h3 class="text-center">Alarm Settings</h3>
                    <div class="input-group">
                        <label for="alarm-height">Alarm Activation Height: <span id="alarm-height-value">1.0</span> m</label>
                        <input type="range" id="alarm-height" min="0.1" max="2.0" step="0.1" value="1.0">
                    </div>
                    <div class="flex justify-center mt-4">
                        <button id="test-alarm-btn" class="button w-full">Test Alarm</button>
                    </div>
                    <div class="flex justify-center mt-2">
                        <button id="test-alarm-warning-btn" class="button w-full">Test Alarm & Warning</button>
                    </div>
                </div>
                
                <div class="info-box">
                    <h3 class="text-center">Graphics & Location Settings</h3>
                    <div id="road-selection-container" class="input-group">
                        <label for="road-detail-select">Road Details:</label>
                        <select id="road-detail-select" class="w-full rounded-md p-2">
                            <option value="all">Load All Roads</option>
                            <option value="highways">Load Highways Only</option>
                            <option value="none">Remove All Roads</option>
                        </select>
                    </div>
                    <div id="location-select-container" class="input-group">
                        <label for="user-location-select">Your Location:</label>
                        <select id="user-location-select" class="w-full rounded-md p-2"></select>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main content area for the map -->
        <div id="map-container">
            <div id="map"></div>
            
            <div class="map-controls-container">
                <button id="toggle-rainfall-warnings" class="map-control-btn"><i class="fas fa-cloud-showers-heavy"></i></button>
                <button id="toggle-tcws" class="map-control-btn"><i class="fas fa-wind"></i></button>
                <button id="toggle-location-marker" class="map-control-btn"><i class="fas fa-map-marker-alt"></i></button>
            </div>
            
            <!-- Map Legend -->
            <div class="map-legend">
                <p class="font-bold mb-2">Flood Legend</p>
                <div class="legend-item"><div class="legend-color" style="background-color: #eab308;"></div> Minor Flooding (0.2m+)</div>
                <div class="legend-item"><div class="legend-color" style="background-color: #f97316;"></div> Moderate Flooding (0.5m+)</div>
                <div class="legend-item"><div class="legend-color" style="background-color: #ef4444;"></div> Major Flooding (1.0m+)</div>
            </div>

            <!-- Custom modal for messages and warnings -->
            <div id="custom-modal-overlay" class="custom-modal-overlay">
                <div id="custom-modal" class="custom-modal">
                    <div id="modal-content">
                        <h3 id="modal-title" class="text-2xl font-bold mb-2"></h3>
                        <p id="modal-message" class="text-gray-400"></p>
                    </div>
                    <button id="modal-close-btn" class="button mt-4">OK</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- State Management ---
        const state = {
            currentFloodHeight: 0,
            precipitationRate: 0,
            totalPrecipitation: 0,
            isSimulationRunning: false,
            simulationInterval: null,
            simulationTime: 0, // in seconds
            simulationDuration: 60 * 60, // default 1 hour in seconds
            sessionType: 'normal',
            userLocation: 'Entire Metro Manila',
            alarmHeight: 1.0,
            forecast: {
                temp: 28,
                humidity: 75,
                rainfall: { h3: 0, h6: 0, h12: 0 },
                flood: { h3: 0, h6: 0, h12: 0 },
                advisories: { rainfall: 'None', tcws: 'None' }
            },
            lastRainfallWarning: 'None',
            lastTcwsWarning: 'None',
            alertTriggered: false,
            // Tone.js for sound effects
            alertSound: new Tone.MembraneSynth().toDestination(),
            // Interval for repeating alarm sound
            alarmInterval: null,
            mapLayers: {
                rainfall: new ol.layer.Vector({ 
                    source: new ol.source.Vector(),
                    style: new ol.style.Style({})
                }),
                tcws: new ol.layer.Vector({ 
                    source: new ol.source.Vector(),
                    style: new ol.style.Style({})
                }),
                locationMarker: new ol.layer.Vector({ 
                    source: new ol.source.Vector(),
                    style: new ol.style.Style({})
                })
            },
            precipitationHistory: []
        };
        
        // --- DOM Elements ---
        const startSimulationBtn = document.getElementById('start-simulation-btn');
        const runInstantBtn = document.getElementById('run-instant-btn');
        const resetSimulationBtn = document.getElementById('reset-simulation-btn');
        const currentFloodHeightEl = document.getElementById('current-flood-height');
        const totalPrecipitationEl = document.getElementById('total-precipitation');
        const precipitationRateInput = document.getElementById('precipitation-rate');
        const precipitationValueEl = document.getElementById('precipitation-value');
        const warningsLogEl = document.getElementById('warnings-log');
        const roadDetailSelect = document.getElementById('road-detail-select');
        const sessionTypeSelect = document.getElementById('session-type');
        const simulationDurationInput = document.getElementById('simulation-duration');
        const durationUnitSelect = document.getElementById('duration-unit');
        const randomPrecipitationCheckbox = document.getElementById('random-precipitation');
        const currentTempEl = document.getElementById('current-temp');
        const currentHumidityEl = document.getElementById('current-humidity');
        const forecast3hrRainfallEl = document.getElementById('forecast-3hr-rainfall');
        const forecast6hrRainfallEl = document.getElementById('forecast-6hr-rainfall');
        const forecast12hrRainfallEl = document.getElementById('forecast-12hr-rainfall');
        const forecast3hrFloodEl = document.getElementById('forecast-3hr-flood');
        const forecast6hrFloodEl = document.getElementById('forecast-6hr-flood');
        const forecast12hrFloodEl = document.getElementById('forecast-12hr-flood');
        const pagasaAdvisoriesEl = document.getElementById('pagasa-advisories');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const toggleRainfallWarningsBtn = document.getElementById('toggle-rainfall-warnings');
        const toggleTcwsBtn = document.getElementById('toggle-tcws');
        const toggleLocationMarkerBtn = document.getElementById('toggle-location-marker');
        const customModalOverlay = document.getElementById('custom-modal-overlay');
        const customModal = document.getElementById('custom-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const precipitationGraph = document.getElementById('precipitation-graph');
        const graphCtx = precipitationGraph.getContext('2d');
        const alarmHeightInput = document.getElementById('alarm-height');
        const alarmHeightValueEl = document.getElementById('alarm-height-value');
        const testAlarmBtn = document.getElementById('test-alarm-btn');
        const testAlarmWarningBtn = document.getElementById('test-alarm-warning-btn');
        const toggleSidebarBtn = document.getElementById('toggle-sidebar-btn');
        const sidebar = document.getElementById('sidebar');

        // --- UI Functions ---
        function showCustomModal(title, message, options = {}) {
            const { showCloseButton = true, isWelcome = false } = options;
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            customModalOverlay.style.display = 'flex';
            const oldButtons = customModal.querySelectorAll('button');
            oldButtons.forEach(btn => btn.remove());
            const closeBtn = document.createElement('button');
            closeBtn.textContent = "OK";
            closeBtn.className = "button mt-4";
            closeBtn.onclick = () => {
                closeCustomModal();
                if (isWelcome) {
                    switchTab('settings');
                }
            };
            customModal.appendChild(closeBtn);
        }

        function closeCustomModal() {
            customModalOverlay.style.display = 'none';
            // Stop the looping alarm sound
            if (state.alarmInterval) {
                clearInterval(state.alarmInterval);
                state.alarmInterval = null;
            }
        }

        function showTemporaryNotification(message) {
            const existingNotification = document.querySelector('.notification-bar');
            if (existingNotification) existingNotification.remove();

            const notification = document.createElement('div');
            notification.className = 'notification-bar';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            notification.addEventListener('click', () => notification.remove());

            setTimeout(() => {
                if (notification && notification.parentElement) {
                    notification.remove();
                }
            }, 5000); // Remove after 5 seconds
        }

        function showEvacuationModal() {
            // Stop the simulation and silence any sound effects
            stopSimulation();
            
            // Start the looping alarm sound
            if (!state.alarmInterval) {
                state.alarmInterval = setInterval(() => {
                    state.alertSound.triggerAttackRelease("C4", "8n");
                }, 1000); // Repeat every 1 second
            }

            modalTitle.textContent = "EVACUATION ALERT!";
            modalMessage.textContent = "Immediate evacuation is advised due to severe flooding.";
            customModalOverlay.style.display = 'flex';
            
            const oldButtons = customModal.querySelectorAll('button');
            oldButtons.forEach(btn => btn.remove());
            
            const dismissButton = document.createElement('button');
            dismissButton.textContent = "Dismiss";
            dismissButton.className = "button btn-red mt-4";
            dismissButton.onclick = () => {
                closeCustomModal();
            };
            customModal.appendChild(dismissButton);

            const callButton = document.createElement('button');
            callButton.textContent = "Call Emergency Services";
            callButton.className = "button mt-4 ml-2";
            callButton.onclick = () => {
                showEmergencyCallModal();
            };
            customModal.appendChild(callButton);
        }

        function showEmergencyCallModal() {
            // Stop the main alarm and show a new modal
            if (state.alarmInterval) {
                clearInterval(state.alarmInterval);
                state.alarmInterval = null;
            }

            modalTitle.textContent = "Emergency Services";
            modalMessage.innerHTML = `<p class="mb-2 text-xl font-bold text-teal-400">Calling 911...</p><p>Please wait for an operator. State your location and situation clearly.</p>`;
            
            const oldButtons = customModal.querySelectorAll('button');
            oldButtons.forEach(btn => btn.remove());

            const closeBtn = document.createElement('button');
            closeBtn.textContent = "OK";
            closeBtn.className = "button mt-4";
            closeBtn.onclick = () => closeCustomModal();
            customModal.appendChild(closeBtn);
        }


        function switchTab(tabName) {
            tabContents.forEach(content => content.classList.remove('active'));
            tabButtons.forEach(button => button.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab-button[data-tab="${tabName}"]`).classList.add('active');
        }

        function updateUI() {
            currentFloodHeightEl.textContent = state.currentFloodHeight.toFixed(2);
            totalPrecipitationEl.textContent = state.totalPrecipitation.toFixed(2);
            precipitationValueEl.textContent = state.precipitationRate.toFixed(1);
            currentTempEl.textContent = state.forecast.temp.toFixed(1);
            currentHumidityEl.textContent = state.forecast.humidity.toFixed(0);
        }

        function updateForecastUI() {
            forecast3hrRainfallEl.textContent = state.forecast.rainfall.h3.toFixed(2) + 'mm';
            forecast6hrRainfallEl.textContent = state.forecast.rainfall.h6.toFixed(2) + 'mm';
            forecast12hrRainfallEl.textContent = state.forecast.rainfall.h12.toFixed(2) + 'mm';
            forecast3hrFloodEl.textContent = state.forecast.flood.h3.toFixed(2) + 'm';
            forecast6hrFloodEl.textContent = state.forecast.flood.h6.toFixed(2) + 'm';
            forecast12hrFloodEl.textContent = state.forecast.flood.h12.toFixed(2) + 'm';
            updatePAGASAAdvisories();
        }

        // --- Map Logic ---
        let map;
        let roadsLayer;
        let locationLayer;

        const manilaCoords = [121.0, 14.6];
        const manilaExtent = ol.proj.fromLonLat([120.95, 14.45]).concat(ol.proj.fromLonLat([121.15, 14.75]));

        function initializeMap() {
            const view = new ol.View({
                center: ol.proj.fromLonLat(manilaCoords),
                zoom: 12,
                extent: manilaExtent,
                constrainResolution: true,
                smoothExtentConstraint: false
            });

            roadsLayer = new ol.layer.Vector({
                source: new ol.source.Vector(),
                style: function (feature) {
                    const floodLevel = feature.get('flood_level') || 0;
                    let color = '#374151'; // Darker gray for no flood
                    let width = 3;
                    
                    if (feature.get('name') === state.userLocation) {
                        width = 5;
                        color = '#0d9488'; // Teal for user's road
                    }

                    if (floodLevel >= 1.0) {
                        color = '#ef4444'; // Red for major flood
                    } else if (floodLevel >= 0.5) {
                        color = '#f97316'; // Orange for moderate flood
                    } else if (floodLevel >= 0.2) {
                        color = '#eab308'; // Yellow for minor flood
                    }

                    return new ol.style.Style({
                        stroke: new ol.style.Stroke({
                            color: color,
                            width: width,
                        }),
                    });
                },
            });

            locationLayer = new ol.layer.Vector({
                source: new ol.source.Vector(),
                style: new ol.style.Style({
                    image: new ol.style.Circle({
                        radius: 7,
                        fill: new ol.style.Fill({ color: '#3b82f6' }),
                        stroke: new ol.style.Stroke({ color: 'white', width: 2 })
                    }),
                })
            });

            map = new ol.Map({
                target: 'map',
                layers: [
                    new ol.layer.Tile({ source: new ol.source.OSM() }),
                    roadsLayer,
                    locationLayer,
                    state.mapLayers.rainfall,
                    state.mapLayers.tcws,
                ],
                view: view,
            });

            map.on('singleclick', function(event) {
                // The fix: Use a layer filter to ensure we only check for features on the roads layer.
                map.forEachFeatureAtPixel(event.pixel, {
                    hitTolerance: 5,
                    layerFilter: function(layer) {
                        return layer === roadsLayer;
                    }
                }, function(feature) {
                    const properties = feature.getProperties();
                    if (properties && properties.name) {
                        showCustomModal(properties.name, `Current Flood Height: ${properties.flood_level ? properties.flood_level.toFixed(2) : '0.00'}m`);
                    }
                });
            });

            loadRoads();
        }

        async function loadRoads() {
            const roadType = roadDetailSelect.value;
            roadsLayer.getSource().clear();
            if (roadType === 'none') {
                 showTemporaryNotification("All roads have been removed.");
                 return;
            }
            
            showTemporaryNotification("Loading roads... Please wait.");
            
            const latMin = 14.45;
            const lonMin = 120.95;
            const latMax = 14.75;
            const lonMax = 121.15;

            let query;
            if (roadType === 'highways') {
                query = `[out:json][timeout:90];(way["highway"~"^(motorway|trunk|primary|secondary)$"](${latMin},${lonMin},${latMax},${lonMax}););out body;>;out skel qt;`;
            } else {
                query = `[out:json][timeout:90];(way["highway"~"^(motorway|trunk|primary|secondary|tertiary|residential|service|unclassified|living_street|track|path)$"](${latMin},${lonMin},${latMax},${lonMax}););out body;>;out skel qt;`;
            }
            
            const overpassUrl = "https://overpass-api.de/api/interpreter";

            try {
                const response = await fetch(overpassUrl, { method: 'POST', body: query });
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                const features = [];
                const roads = [];
                const nodes = new Map(data.elements.filter(el => el.type === 'node').map(el => [el.id, el]));
                
                // Define special flood-prone areas with lower resistance
                const floodProneAreas = {
                    'Ermita, City of Manila': 0.1,
                    'Paco, City of Manila': 0.1,
                    'Malabon': 0.2,
                    'Navotas': 0.2
                };

                data.elements.forEach(el => {
                    if (el.type === 'way' && el.tags && el.tags.name && el.nodes) {
                        const coords = el.nodes.map(nodeId => {
                            const node = nodes.get(nodeId);
                            return node ? [node.lon, node.lat] : null;
                        }).filter(c => c !== null);

                        if (coords.length > 1) {
                            let floodResistance = 0.5; // Default resistance
                            
                            // Check for special flood-prone areas
                            const areaName = el.tags.name;
                            if (floodProneAreas[areaName]) {
                                floodResistance = floodProneAreas[areaName];
                            } else {
                                switch (el.tags.highway) {
                                    case 'motorway':
                                    case 'trunk':
                                    case 'primary':
                                        floodResistance = 0.8;
                                        break;
                                    case 'secondary':
                                    case 'tertiary':
                                        floodResistance = 0.6;
                                        break;
                                    case 'residential':
                                    case 'service':
                                        floodResistance = 0.3;
                                        break;
                                }
                            }

                            const geojsonFeature = {
                                type: "Feature",
                                geometry: { type: "LineString", coordinates: coords },
                                properties: { name: el.tags.name, highway: el.tags.highway, flood_level: 0, flood_resistance: floodResistance }
                            };
                            features.push(geojsonFeature);
                            // Store road name and a single coordinate for the location select
                            roads.push({ name: el.tags.name, coords: ol.proj.fromLonLat(coords[0]) });
                        }
                    }
                });

                const geojsonData = { type: "FeatureCollection", features: features };
                
                const accurateRoadsSource = new ol.source.Vector({
                    features: new ol.format.GeoJSON().readFeatures(geojsonData, {
                        featureProjection: 'EPSG:3857',
                        dataProjection: 'EPSG:4326',
                    }),
                });
                
                roadsLayer.setSource(accurateRoadsSource);
                populateLocationSelect(roads);
                showTemporaryNotification("Roads have been loaded!");
            } catch (error) {
                console.error("Failed to load road data:", error);
                showTemporaryNotification("Error: Failed to load road data.");
            }
        }
        
        function populateLocationSelect(roads) {
            const uniqueRoads = [...new Set(roads.map(r => r.name))].sort();
            uniqueRoads.unshift("Entire Metro Manila");
            
            const locationSelect = document.getElementById('user-location-select');
            if (locationSelect) {
                locationSelect.innerHTML = uniqueRoads.map(name => `<option value="${name}">${name}</option>`).join('');

                // Check local storage for a previously saved location
                const savedLocation = localStorage.getItem('userLocation');
                if (savedLocation && uniqueRoads.includes(savedLocation)) {
                    locationSelect.value = savedLocation;
                    state.userLocation = savedLocation;
                    const selectedRoad = roads.find(r => r.name === state.userLocation);
                    updateLocationMarker(selectedRoad);
                } else {
                    localStorage.removeItem('userLocation'); // Clear invalid or old data
                }

                locationSelect.addEventListener('change', (e) => {
                    state.userLocation = e.target.value;
                    localStorage.setItem('userLocation', state.userLocation); // Save location to local storage
                    resetSimulation();
                    const selectedRoad = roads.find(r => r.name === state.userLocation);
                    updateLocationMarker(selectedRoad);
                });
            }
        }
        
        function updateLocationMarker(road) {
            const source = locationLayer.getSource();
            source.clear();
            if (road && road.coords) {
                const marker = new ol.Feature({ geometry: new ol.geom.Point(road.coords) });
                source.addFeature(marker);
            }
        }
        
        function toggleMapLayer(layerType) {
            const layer = state.mapLayers[layerType];
            if (layer) layer.setVisible(!layer.getVisible());
        }

        // --- Simulation Logic ---
        function getPrecipitationBySessionType(sessionType, timeInHours, baseRate) {
            const totalDuration = state.simulationDuration / 3600;
            const timeRatio = timeInHours / totalDuration;
            
            let rate = baseRate;
            if (sessionType === 'normal') {
                rate = baseRate;
            } else if (sessionType === 'rain') {
                rate = baseRate + 10 * Math.sin(timeRatio * Math.PI);
            } else if (sessionType === 'thunderstorm') {
                rate = baseRate + 35 * Math.sin(timeRatio * Math.PI) * Math.sin(timeRatio * 4 * Math.PI);
            } else if (sessionType === 'tropical-cyclone') {
                rate = baseRate + 85 * Math.sin(timeRatio * Math.PI);
            }
            return Math.max(0, rate);
        }
        
        function drawPrecipitationGraph() {
            const data = state.precipitationHistory;
            const maxVal = Math.max(...data, 10);
            const w = precipitationGraph.width;
            const h = precipitationGraph.height;
            const barWidth = w / data.length;

            graphCtx.clearRect(0, 0, w, h);
            
            // Draw axes
            graphCtx.strokeStyle = '#4a5568';
            graphCtx.lineWidth = 1;
            graphCtx.beginPath();
            graphCtx.moveTo(0, h);
            graphCtx.lineTo(w, h);
            graphCtx.stroke();
            
            // Draw bars
            graphCtx.fillStyle = '#0d9488';
            data.forEach((val, i) => {
                const barHeight = (val / maxVal) * h;
                graphCtx.fillRect(i * barWidth, h - barHeight, barWidth, barHeight);
            });
        }

        function parseDurationInput() {
            const value = parseFloat(simulationDurationInput.value);
            const unit = durationUnitSelect.value;
            let seconds = 0;
            if (unit === 'minutes') seconds = value * 60;
            else if (unit === 'hours') seconds = value * 3600;
            else if (unit === 'days') seconds = value * 86400;
            return seconds;
        }

        function startSimulation() {
            if (state.isSimulationRunning) {
                stopSimulation();
            } else {
                state.isSimulationRunning = true;
                state.simulationDuration = parseDurationInput();
                startSimulationBtn.textContent = 'Stop Simulation';
                startSimulationBtn.classList.add('btn-red');
                startSimulationBtn.classList.remove('button');
                state.simulationInterval = setInterval(stepSimulation, 1000);
                showCustomModal('Simulation Started', `Starting a new ${sessionTypeSelect.value} simulation for ${simulationDurationInput.value} ${durationUnitSelect.value}.`);
            }
        }
        
        function runInstantSimulation() {
            stopSimulation();
            state.simulationDuration = parseDurationInput();
            state.precipitationHistory = [];
            
            let totalPrecipitation = 0;
            let floodHeight = 0;
            let lastPrecipitationRate = 0;
            
            for(let t = 0; t < state.simulationDuration; t++) {
                let currentPrecipitation = getPrecipitationBySessionType(state.sessionType, t / 3600, state.precipitationRate);
                 if (randomPrecipitationCheckbox.checked) {
                    currentPrecipitation += (Math.random() - 0.5) * 2;
                }
                currentPrecipitation = Math.max(0, currentPrecipitation);

                totalPrecipitation += currentPrecipitation / 3600;
                floodHeight += (currentPrecipitation / 3600) * 0.02; // Increased flood factor
                lastPrecipitationRate = currentPrecipitation;
                state.precipitationHistory.push(currentPrecipitation);
            }
            
            state.totalPrecipitation = totalPrecipitation;
            state.currentFloodHeight = floodHeight;
            state.precipitationRate = lastPrecipitationRate;
            
            const features = roadsLayer.getSource().getFeatures();
            features.forEach(feature => {
                const floodResistance = feature.get('flood_resistance');
                const newFloodLevel = state.currentFloodHeight * (1 - floodResistance);
                feature.set('flood_level', newFloodLevel);
            });
            roadsLayer.changed();
            
            updateUI();
            updateForecasts();
            checkWarningStatus();
            drawPrecipitationGraph();
            
            showCustomModal('Instant Results', `Simulation for ${simulationDurationInput.value} ${durationUnitSelect.value} completed instantly. Final flood height is ${state.currentFloodHeight.toFixed(2)}m.`);
        }

        function stopSimulation() {
            state.isSimulationRunning = false;
            startSimulationBtn.textContent = 'Start Simulation';
            startSimulationBtn.classList.remove('btn-red');
            startSimulationBtn.classList.add('button');
            clearInterval(state.simulationInterval);
        }

        function stepSimulation() {
            state.simulationTime += 1;
            
            if (state.simulationTime > state.simulationDuration) {
                stopSimulation();
                showCustomModal('Simulation Complete', `The simulation has completed its run.`);
                return;
            }
            
            let currentPrecipitation = getPrecipitationBySessionType(state.sessionType, state.simulationTime / 3600, state.precipitationRate);
            if (randomPrecipitationCheckbox.checked) {
                currentPrecipitation += (Math.random() - 0.5) * 2;
                currentPrecipitation = Math.max(0, currentPrecipitation);
            }
            
            state.precipitationRate = currentPrecipitation;
            state.totalPrecipitation += currentPrecipitation / 3600;
            
            state.forecast.temp -= (currentPrecipitation / 2000);
            state.forecast.humidity += (currentPrecipitation / 1000);
            state.forecast.temp = Math.max(20, Math.min(35, state.forecast.temp));
            state.forecast.humidity = Math.max(50, Math.min(100, state.forecast.humidity));
            
            // Increment the overall flood height for the entire location
            let floodIncrement = (currentPrecipitation / 3600) * 0.02; // Increased flood factor
            state.currentFloodHeight += floodIncrement;
            
            state.precipitationHistory.push(currentPrecipitation);
            if (state.precipitationHistory.length > 300) { // Keep history manageable
                state.precipitationHistory.shift();
            }
            drawPrecipitationGraph();

            const features = roadsLayer.getSource().getFeatures();
            features.forEach(feature => {
                const floodResistance = feature.get('flood_resistance');
                const newFloodLevel = state.currentFloodHeight * (1 - floodResistance);
                feature.set('flood_level', newFloodLevel);
            });
            roadsLayer.changed();
            
            checkWarningStatus();
            updateUI();
            updateForecasts();

            // Check for evacuation alert trigger
            if (state.currentFloodHeight >= state.alarmHeight && !state.alertTriggered) {
                state.alertTriggered = true;
                showEvacuationModal();
            }
        }
        
        function calculateForecasts(hoursAhead) {
            const timeInHours = state.simulationTime / 3600;
            const futureTime = timeInHours + hoursAhead;
            let totalPrecipitation = 0;
            let floodHeight = state.currentFloodHeight;

            for (let i = timeInHours; i < futureTime; i += 1/3600) {
                let currentPrecip = getPrecipitationBySessionType(state.sessionType, i, state.precipitationRate);
                currentPrecip += (Math.random() - 0.5) * 2;
                currentPrecip = Math.max(0, currentPrecip);
                totalPrecipitation += currentPrecip / 3600;
                floodHeight += (currentPrecip / 3600) * 0.02; // Increased flood factor
            }
            return {
                rainfall: totalPrecipitation,
                flood: floodHeight
            };
        }
        
        function updateForecasts() {
            const forecast3hr = calculateForecasts(3);
            const forecast6hr = calculateForecasts(6);
            const forecast12hr = calculateForecasts(12);

            state.forecast.rainfall.h3 = forecast3hr.rainfall;
            state.forecast.rainfall.h6 = forecast6hr.rainfall;
            state.forecast.rainfall.h12 = forecast12hr.rainfall;

            state.forecast.flood.h3 = forecast3hr.flood;
            state.forecast.flood.h6 = forecast6hr.flood;
            state.forecast.flood.h12 = forecast12hr.flood;

            updateForecastUI();
        }

        function checkWarningStatus() {
            const currentPrecip = state.precipitationRate;
            let rainfallAdvisory = 'None';
            let tcwsAdvisory = 'None';

            if (currentPrecip >= 7.5 && currentPrecip < 15) { rainfallAdvisory = 'Yellow Warning'; }
            else if (currentPrecip >= 15 && currentPrecip < 30) { rainfallAdvisory = 'Orange Warning'; }
            else if (currentPrecip >= 30) { rainfallAdvisory = 'Red Warning'; }
            
            if (state.sessionType === 'tropical-cyclone') {
                if (currentPrecip > 50 && currentPrecip < 80) { tcwsAdvisory = 'TCWS #1'; }
                else if (currentPrecip > 80 && currentPrecip < 120) { tcwsAdvisory = 'TCWS #2'; }
                else if (currentPrecip > 120) { tcwsAdvisory = 'TCWS #3'; }
            }
            
            if (rainfallAdvisory !== state.lastRainfallWarning) {
                state.lastRainfallWarning = rainfallAdvisory;
                if (rainfallAdvisory !== 'None') { logWarning(rainfallAdvisory); }
            }
            if (tcwsAdvisory !== state.lastTcwsWarning) {
                state.lastTcwsWarning = tcwsAdvisory;
                if (tcwsAdvisory !== 'None') { logWarning(tcwsAdvisory); }
            }
            state.forecast.advisories.rainfall = rainfallAdvisory;
            state.forecast.advisories.tcws = tcwsAdvisory;
            updatePAGASAAdvisories();
        }

        function logWarning(advisoryText) {
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const logEntry = document.createElement('div');
            logEntry.classList.add('p-2', 'rounded-md', 'text-sm', 'warning-box');
            if (advisoryText.includes('Yellow')) logEntry.classList.add('yellow');
            else if (advisoryText.includes('Orange')) logEntry.classList.add('orange');
            else if (advisoryText.includes('Red') || advisoryText.includes('TCWS')) logEntry.classList.add('red');
            
            logEntry.innerHTML = `<p class="warning-title">New Alert</p><p class="warning-description">${advisoryText}</p><p class="text-xs text-gray-500 mt-1">${timestamp}</p>`;
            
            if (warningsLogEl.firstChild) { warningsLogEl.insertBefore(logEntry, warningsLogEl.firstChild); }
            else { warningsLogEl.appendChild(logEntry); }
        }
        
        function updatePAGASAAdvisories() {
            const advisories = state.forecast.advisories;
            pagasaAdvisoriesEl.innerHTML = '';
            function createAdvisoryCard(title, description, colorClass) {
                const card = document.createElement('div');
                card.className = `info-box p-4 bg-gray-800 border-l-4 rounded-lg shadow-md ${colorClass}`;
                card.innerHTML = `<p class="font-bold text-lg">${title}</p><p class="text-sm text-gray-400">${description}</p>`;
                pagasaAdvisoriesEl.appendChild(card);
            }
            if (advisories.rainfall !== 'None') {
                let color = 'border-yellow-500';
                if (advisories.rainfall.includes('Orange')) color = 'border-orange-500';
                if (advisories.rainfall.includes('Red')) color = 'border-red-500';
                createAdvisoryCard('Rainfall Advisory', advisories.rainfall, color);
            }
            if (advisories.tcws !== 'None') {
                let color = 'border-blue-500';
                if (advisories.tcws.includes('#2') || advisories.tcws.includes('#3')) color = 'border-red-500';
                createAdvisoryCard('Tropical Cyclone Warning Signal', advisories.tcws, color);
            }
            if (advisories.rainfall === 'None' && advisories.tcws === 'None') {
                pagasaAdvisoriesEl.innerHTML = `<p class="text-sm text-center text-gray-400">Advisories will appear here during a simulation.</p>`;
            }
        }

        function resetSimulation() {
            stopSimulation();
            state.currentFloodHeight = 0;
            state.simulationTime = 0;
            state.totalPrecipitation = 0;
            state.precipitationRate = 0;
            state.alertTriggered = false;
            state.lastRainfallWarning = 'None';
            state.lastTcwsWarning = 'None';
            precipitationRateInput.value = 0;
            state.precipitationHistory = [];
            
            currentFloodHeightEl.textContent = '0.00';
            totalPrecipitationEl.textContent = '0.00';
            warningsLogEl.innerHTML = '';
            
            const features = roadsLayer.getSource().getFeatures();
            features.forEach(feature => { feature.set('flood_level', 0); });
            roadsLayer.changed();
            updateUI();
            updateForecasts();
            drawPrecipitationGraph();
            showCustomModal('Simulation Reset', 'The simulation has been reset to its initial state.');
        }

        function testAlarm() {
            // Start a looping sound for the alarm test
            if (!state.alarmInterval) {
                state.alarmInterval = setInterval(() => {
                    state.alertSound.triggerAttackRelease("C4", "8n");
                }, 1000);
            }
            showCustomModal("Alarm Test", "The alarm has been successfully triggered. Close this modal to stop the sound.");
        }
        
        function testAlarmAndWarning() {
            // Store original values to restore them later
            const originalFloodHeight = state.currentFloodHeight;
            const originalPrecipRate = state.precipitationRate;
            
            // Set values to trigger the alarm and a "Red" warning
            state.currentFloodHeight = state.alarmHeight + 0.1;
            state.precipitationRate = 35; 
            
            // Trigger the warning and alarm logic
            checkWarningStatus();
            updateUI();
            showEvacuationModal();

            // Reset values after a short delay
            setTimeout(() => {
                state.currentFloodHeight = originalFloodHeight;
                state.precipitationRate = originalPrecipRate;
                updateUI();
            }, 3000);
        }

        // --- Event Listeners and Initialization ---
        function updateClockDisplay() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            document.getElementById('current-time').textContent = now.toLocaleDateString('en-US', options);
        }

        function initializeApp() {
            tabButtons.forEach(button => {
                button.addEventListener('click', () => switchTab(button.dataset.tab));
            });
            startSimulationBtn.addEventListener('click', startSimulation);
            runInstantBtn.addEventListener('click', runInstantSimulation);
            resetSimulationBtn.addEventListener('click', resetSimulation);
            testAlarmBtn.addEventListener('click', testAlarm);
            testAlarmWarningBtn.addEventListener('click', testAlarmAndWarning);
            
            // Mobile sidebar toggle logic
            toggleSidebarBtn.addEventListener('click', () => {
                sidebar.classList.toggle('active');
                if (sidebar.classList.contains('active')) {
                    toggleSidebarBtn.innerHTML = '<i class="fas fa-times"></i>';
                } else {
                    toggleSidebarBtn.innerHTML = '<i class="fas fa-bars"></i>';
                }
            });

            precipitationRateInput.addEventListener('input', (e) => {
                state.precipitationRate = parseInt(e.target.value);
                precipitationValueEl.textContent = state.precipitationRate;
            });
            
            alarmHeightInput.addEventListener('input', (e) => {
                state.alarmHeight = parseFloat(e.target.value);
                alarmHeightValueEl.textContent = state.alarmHeight.toFixed(1);
            });

            sessionTypeSelect.addEventListener('change', (e) => {
                state.sessionType = e.target.value;
                if (state.sessionType === 'normal') { randomPrecipitationCheckbox.checked = true; }
            });
            roadDetailSelect.addEventListener('change', () => {
                resetSimulation();
                loadRoads();
            });
            toggleRainfallWarningsBtn.addEventListener('click', () => toggleMapLayer('rainfall'));
            toggleTcwsBtn.addEventListener('click', () => toggleMapLayer('tcws'));
            toggleLocationMarkerBtn.addEventListener('click', () => toggleMapLayer('locationMarker'));
            // The modal close button now handles stopping the alarm
            modalCloseBtn.addEventListener('click', closeCustomModal);
            
            initializeMap();
            setInterval(updateClockDisplay, 1000);
            updateClockDisplay();
            drawPrecipitationGraph();
            showCustomModal('Welcome!', 'Please select your location from the Settings tab to begin. The flood simulation will be localized to your area.', { isWelcome: true });
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
